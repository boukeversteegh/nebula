<div id="dropbox" data-path="{{data.path}}">
	<h1>
	{{data.path}}
	{{^data.folder}}
		/
	{{/data.folder}}
	</h1>
	
	{{#data}}
	<button id="mkdir" class="green" onClick="var name = prompt('Please enter a name'); if( name ) { view.xhttp('POST', '/files{{path}}/' + name, {'action':'mkdir'}); }">Create folder</button>
	<div class="playlist">
		<div id="folders">
			<ul>
				<li id="parentfolder" class="folder" data-path="{{parent}}"><a class="showview" href="/view/files{{parent}}">..</a></li>
				{{#folders}}
				<li class="folder" data-file="{{.}}" data-path="{{path}}/{{.}}">
					<a class="showview" href="/view/files{{path}}/{{.}}">{{.}}</a>
				</li>
				{{/folders}}
				
			</ul>
		</div>
		<div id="files">
			<table border="0" width="100%" cellspacing="0">
				{{#files}}
				<tr class="file" data-file="{{file}}" data-path="{{path}}/{{file}}">
					<td align="right" width="40">{{id3.track_num.0}}</td>
					
					{{#id3.artist}}{{#id3.title}}
						<td width="300"><a href="/view/play{{{path}}}/{{{file}}}" class="showview">{{id3.artist}}</a></td>
						<td><a href="/view/play{{{path}}}/{{{file}}}" class="showview">{{id3.title}}</a></td>
						<td><a href="/view/play{{{path}}}/{{{file}}}" class="showview">{{file}}</a></td>
					{{/id3.title}}{{/id3.artist}}
					
					{{^id3.title}}
						<td colspan="3"><a href="/view/play{{{path}}}/{{{file}}}" class="showview">{{file}}</a></td>
					{{/id3.title}}
					
					<td width="20">
						<button onClick="confirm('Are you sure you want to delete ' + this.dataset.href + '?') && view.xhttp('DELETE', this.dataset.href)" data-href="/files{{path}}/{{file}}" class="delete">delete</button></td>
					</td>
				</tr>
				{{/files}}
				{{^files}}
				<tr><td><i>This folder is empty</i></td></tr>
				{{/files}}
			</table>
		</div>
	</div>
	<div class="playlist" id="uploads">
		<h3>Uploads</h3>
		<ul id="uploads_progress"></ul>
		{{/data}}
	</div>
	<script type="text/javascript">
		dragdrop_init();
		window.view.filepath = "{{{data.path}}}";
		$('button.delete').button();
		$('#files tr.file, #folders li.folder').not('#parentfolder').draggable({
			revert: 'invalid',
			cursorAt: { left: -5 },
			delay: 50,
			distance: 10,
			helper: function( event ) {
				return $( '<div class="file"/>' ).button().css({width: 'auto'}).html($(this).find('a').clone().css({padding:'0.25em', display: 'inline-block'}));
			}
		});
		$('#folders li.folder').droppable({
			drop: function( event, ui ) {
					var sourcepath = ui.draggable[0].dataset.path;
					var targetpath = this.dataset.path + '/' + ui.draggable[0].dataset.file
					console.log([sourcepath, targetpath])
					view.xhttp('POST', '/files' + sourcepath, {'action':'mv', 'target': targetpath})
					event.preventDefault();
					event.stopPropagation();
					return false;
				},
			hoverClass: "ui-state-hover"
		})
		$('#mkdir').button();
		$('#folders .folder a').button();
		window.uploader.refresh();
	</script>
</div>
