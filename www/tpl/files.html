<div id="dropbox">
	<h1>
	{{data.path}}
	{{^data.folder}}
		/
	{{/data.folder}}
	</h1>
	
	{{#data}}
	<button id="mkdir" class="green" onClick="var name = prompt('Please enter a name'); if( name ) { view.xhttp('POST', '/files{{path}}/' + name, {'action':'mkdir'}); }">Create folder</button>
	<div class="playlist">
		<div id="folders">
			<ul>
				<li class="folder"><a class="showview" data-path="{{data.parent}}" href="/view/files{{data.parent}}">..</a></li>
				{{#folders}}
				<li class="folder" data-file="{{.}}" data-path="{{path}}/{{.}}">
					<a class="showview" href="/view/files{{path}}/{{.}}">{{.}}</a>
				</li>
				{{/folders}}
				
			</ul>
		</div>
		<div id="files">
			<ul>
				{{#files}}
				<li class="file" data-file="{{.}}" data-path="{{path}}/{{.}}">
					<a href="/view/play{{{path}}}/{{{.}}}" class="showview">{{.}}</a>
					<button onClick="confirm('Are you sure you want to delete ' + this.dataset.href + '?') && view.xhttp('DELETE', this.dataset.href)" data-href="/files{{path}}/{{.}}" class="delete">delete</button>
				</li>
				{{/files}}
				{{^files}}
				<li><i>This folder is empty</i></li>
				{{/files}}
			</ul>
		</div>
	</div>
	<div class="playlist" id="uploads">
		<h3>Uploads</h3>
		<ul id="uploads_progress"></ul>
		{{/data}}
	</div>
	<script type="text/javascript">
		dragdrop_init();
		window.view.filepath = "{{{data.path}}}";
		$('#files li.file, #folders li.folder').remove('#mkdir').draggable({ revert: 'invalid', cursorAt: { left: -5 }})
		$('#folders li.folder').droppable({
			drop: function( event, ui ) {
					var sourcepath = ui.draggable[0].dataset.path;
					var targetpath = this.dataset.path + '/' + ui.draggable[0].dataset.file
					console.log([sourcepath, targetpath])
					view.xhttp('POST', '/files' + sourcepath, {'action':'mv', 'target': targetpath})
					event.preventDefault();
					event.stopPropagation();
					return false;
				},
			hoverClass: "ui-state-hover"
		})
		$('#mkdir').button();
		$('#folders .folder a').button();
		window.uploader.refresh();
	</script>
</div>
